{"version":3,"file":"registerElement.js","sources":["../../elements/registerElement.tsx"],"sourcesContent":["import {AssignableType} from \"@co.mmons/js-utils/core\";\nimport {compose, noShadowDOM, register} from \"component-register\";\nimport {getCurrentElement, withSolid} from \"solid-element\";\nimport {splitProps} from \"solid-js\";\nimport {Fragment, JSX} from \"solid-js/h/jsx-runtime\";\nimport {CustomElement} from \"./CustomElement\";\n\nexport function registerElement<ElementType extends CustomElement>(tagName: string, elementConstructor: AssignableType<ElementType>) {\n\n    if (customElements.get(tagName)) {\n        return;\n    }\n\n    const extendedConstructor: {__reactive: string[], __noShadow: boolean, __shadowStyles: string | string[]} = elementConstructor as any;\n\n    const propsDefinitions: {[propName: string]: {\n            value: undefined;\n            attribute: string;\n            notify: boolean;\n            reflect: boolean;\n            parse: boolean;\n        }} = {__children: undefined as any};\n\n    for (const prop of extendedConstructor.__reactive ?? []) {\n        propsDefinitions[prop] = Object.assign({value: undefined});\n    }\n\n    const element = compose(register(tagName, propsDefinitions, {BaseElement: elementConstructor}), withSolid)((rawProps) => {\n\n        const shadow = !extendedConstructor.__noShadow;\n        const shadowStyles = shadow && extendedConstructor.__shadowStyles;\n\n        if (!shadow) {\n            noShadowDOM();\n        }\n\n        const [children, props] = splitProps(rawProps, [\"__children\"]);\n        const element: {template: (args: any) => JSX.Element} = getCurrentElement() as any;\n        return <Fragment>\n            {shadowStyles && (typeof shadowStyles === \"string\" ? [shadowStyles] : shadowStyles).map(style => <style>{style}</style>)}\n            {element.template({props, children: children?.[\"__children\"] ?? []})}\n        </Fragment>\n    });\n}\n"],"names":["registerElement","tagName","elementConstructor","customElements","get","extendedConstructor","propsDefinitions","__children","undefined","prop","__reactive","Object","assign","value","compose","register","BaseElement","withSolid","rawProps","shadow","__noShadow","shadowStyles","__shadowStyles","noShadowDOM","children","props","splitProps","element","getCurrentElement","_$createComponent","Fragment","_$memo","map","style","_el$","_tmpl$","_$insert","template"],"mappings":";;;;;;AAOO,SAASA,EAAmDC,GAAiBC,GAAiD;AAEjI,MAAIC,eAAeC,IAAIH,CAAO;AAC1B;AAGJ,QAAMI,IAAsGH,GAEtGI,IAMG;AAAA,IAACC,YAAYC;AAAAA;AAEtB,aAAWC,KAAQJ,EAAoBK,cAAc,CAAA;AACjDJ,IAAAA,EAAiBG,CAAI,IAAIE,OAAOC,OAAO;AAAA,MAACC,OAAOL;AAAAA,IAAS,CAAC;AAG7CM,EAAAA,EAAQC,EAASd,GAASK,GAAkB;AAAA,IAACU,aAAad;AAAAA,EAAkB,CAAC,GAAGe,CAAS,EAAGC,CAAAA,MAAa;AAErH,UAAMC,IAAS,CAACd,EAAoBe,YAC9BC,IAAeF,KAAUd,EAAoBiB;AAEnD,IAAKH,KACDI;AAGJ,UAAM,CAACC,GAAUC,CAAK,IAAIC,EAAWR,GAAU,CAAC,YAAY,CAAC,GACvDS,IAAkDC;AACxD,WAAAC,EAAQC,GAAQ;AAAA,MAAA,IAAA,WAAA;AAAA,eAAA,CAAAC,EAAA,MACXV,MAAiB,OAAOA,KAAiB,WAAW,CAACA,CAAY,IAAIA,GAAcW,IAAIC,CAAAA,OAAK,MAAA;AAAA,gBAAAC,IAAAC,EAAA,UAAA,EAAA;AAAAC,iBAAAA,EAAAF,GAAYD,CAAK,GAAAC;AAAA,QAAA,GAAA,CAAS,CAAC,GAAAH,EAAA,MACvHJ,EAAQU,SAAS;AAAA,UAACZ,OAAAA;AAAAA,UAAOD,WAAUA,KAAAA,gBAAAA,EAAW,eAAiB,CAAA;AAAA,QAAG,CAAA,CAAC,CAAA;AAAA,MAAA;AAAA,IAAA,CAAA;AAAA,EAE5E,CAAC;AACL;"}