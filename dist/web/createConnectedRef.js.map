{"version":3,"file":"createConnectedRef.js","sources":["../../src/lib/web/createConnectedRef.ts"],"sourcesContent":["import {Accessor, createSignal, onCleanup, onMount} from \"solid-js\";\n\nconst refs: Map<Node, (fn: (el: Node) => Node) => void> = new Map();\n\nconst observer = new MutationObserver((records) => {\n\n    if (!refs.size) {\n        return;\n    }\n\n    for (const record of records) {\n        const {addedNodes} = record;\n        if (addedNodes) {\n            for (let i = 0; i < addedNodes.length; i++) {\n                const n = addedNodes[i];\n                const c = refs.get(n);\n\n                if (c) {\n                    c(() => n);\n                    refs.delete(n);\n                }\n\n                if (n.hasChildNodes()) {\n                    for (const [r, c] of refs.entries()) {\n                        if (n.contains(r)) {\n                            c(() => r);\n                            refs.delete(r);\n                        }\n                    }\n                }\n            }\n        }\n    }\n})\n\nobserver.observe(document, {childList: true, subtree: true});\n\nexport function createConnectedRef<T extends Node>(): [Accessor<T | undefined>, (ref: T) => void] {\n    const [ref, setRef] = createSignal<T>();\n    const [mounted, setMounted] = createSignal<T>();\n\n    onMount(() => {\n        const r = ref()!;\n        if (r.isConnected) {\n            setMounted(() => r);\n        } else {\n            refs.set(r, setMounted);\n        }\n    })\n\n    onCleanup(() => {\n        const r = ref();\n        if (r) {\n            refs.delete(r);\n        }\n    })\n\n    return [mounted, setRef];\n}\n"],"names":["refs","observer","records","record","addedNodes","i","n","c","r","createConnectedRef","ref","setRef","createSignal","mounted","setMounted","onMount","onCleanup"],"mappings":";AAEA,MAAMA,wBAAwD,OAExDC,IAAW,IAAI,iBAAiB,CAACC,MAAY;AAE3C,MAACF,EAAK;AAIV,eAAWG,KAAUD,GAAS;AACpB,YAAA,EAAC,YAAAE,EAAc,IAAAD;AACrB,UAAIC;AACA,iBAASC,IAAI,GAAGA,IAAID,EAAW,QAAQC,KAAK;AAClC,gBAAAC,IAAIF,EAAWC,CAAC,GAChBE,IAAIP,EAAK,IAAIM,CAAC;AAOhB,cALAC,MACAA,EAAE,MAAMD,CAAC,GACTN,EAAK,OAAOM,CAAC,IAGbA,EAAE;AACF,uBAAW,CAACE,GAAGD,CAAC,KAAKP,EAAK;AAClB,cAAAM,EAAE,SAASE,CAAC,MACZD,EAAE,MAAMC,CAAC,GACTR,EAAK,OAAOQ,CAAC;AAAA,QAI7B;AAAA,IAER;AACJ,CAAC;AAEDP,EAAS,QAAQ,UAAU,EAAC,WAAW,IAAM,SAAS,IAAK;AAEpD,SAASQ,IAAkF;AAC9F,QAAM,CAACC,GAAKC,CAAM,IAAIC,EAAgB,GAChC,CAACC,GAASC,CAAU,IAAIF,EAAgB;AAE9C,SAAAG,EAAQ,MAAM;AACV,UAAMP,IAAIE;AACV,IAAIF,EAAE,cACFM,EAAW,MAAMN,CAAC,IAEbR,EAAA,IAAIQ,GAAGM,CAAU;AAAA,EAC1B,CACH,GAEDE,EAAU,MAAM;AACZ,UAAMR,IAAIE;AACV,IAAIF,KACAR,EAAK,OAAOQ,CAAC;AAAA,EACjB,CACH,GAEM,CAACK,GAASF,CAAM;AAC3B;"}