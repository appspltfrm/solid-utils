{"version":3,"file":"createConnectedElementSignal.js","sources":["../../src/lib/web/createConnectedElementSignal.ts"],"sourcesContent":["import {Accessor, createEffect, createSignal, onCleanup, onMount} from \"solid-js\";\n\nconst refs: Map<Node, (fn: (el: Node) => Node) => void> = new Map();\n\nconst observer = \"MutationObserver\" in globalThis ? new MutationObserver((records) => {\n\n    if (!refs.size) {\n        return;\n    }\n\n    for (const record of records) {\n        const {addedNodes} = record;\n        if (addedNodes) {\n            for (let i = 0; i < addedNodes.length; i++) {\n                const n = addedNodes[i];\n                const c = refs.get(n);\n\n                if (c) {\n                    c(() => n);\n                    refs.delete(n);\n                }\n\n                if (n.hasChildNodes()) {\n                    for (const [r, c] of refs.entries()) {\n                        if (n.contains(r)) {\n                            c(() => r);\n                            refs.delete(r);\n                        }\n                    }\n                }\n            }\n        }\n    }\n}) : undefined;\n\nif (observer) {\n    observer.observe(document, {childList: true, subtree: true});\n}\n\nexport function createConnectedElementSignal<T extends Element>(element?: T): [Accessor<T | undefined>, (ref: T) => void] {\n    const [ref, setRef] = createSignal<T | undefined>(element);\n    const [mounted, setMounted] = createSignal<T>();\n\n    createEffect((prev) => {\n\n        const r = ref()!;\n\n        if (r.isConnected) {\n            setMounted(() => r);\n        } else if (prev !== r) {\n            refs.set(r, setMounted);\n        }\n\n        return r;\n    })\n\n    onCleanup(() => {\n        const r = ref();\n        if (r) {\n            refs.delete(r);\n        }\n    })\n\n    return [mounted, setRef];\n}\n"],"names":["refs","observer","records","record","addedNodes","i","n","c","r","createConnectedElementSignal","element","ref","setRef","createSignal","mounted","setMounted","createEffect","prev","onCleanup"],"mappings":";AAEA,MAAMA,wBAAwD,IAAI,GAE5DC,IAAW,sBAAsB,aAAa,IAAI,iBAAiB,CAACC,MAAY;AAE9E,MAACF,EAAK;AAIV,eAAWG,KAAUD,GAAS;AACpB,YAAA,EAAC,YAAAE,MAAcD;AACrB,UAAIC;AACA,iBAASC,IAAI,GAAGA,IAAID,EAAW,QAAQC,KAAK;AAClC,gBAAAC,IAAIF,EAAWC,CAAC,GAChBE,IAAIP,EAAK,IAAIM,CAAC;AAOhB,cALAC,MACAA,EAAE,MAAMD,CAAC,GACTN,EAAK,OAAOM,CAAC,IAGbA,EAAE;AACF,uBAAW,CAACE,GAAGD,CAAC,KAAKP,EAAK;AAClB,cAAAM,EAAE,SAASE,CAAC,MACZD,EAAE,MAAMC,CAAC,GACTR,EAAK,OAAOQ,CAAC;AAAA,QAGzB;AAAA,IAER;AAER,CAAC,IAAI;AAEDP,KACAA,EAAS,QAAQ,UAAU,EAAC,WAAW,IAAM,SAAS,IAAK;AAGxD,SAASQ,EAAgDC,GAA0D;AACtH,QAAM,CAACC,GAAKC,CAAM,IAAIC,EAA4BH,CAAO,GACnD,CAACI,GAASC,CAAU,IAAIF,EAAgB;AAE9C,SAAAG,EAAa,CAACC,MAAS;AAEnB,UAAMT,IAAIG,EAAI;AAEd,WAAIH,EAAE,cACFO,EAAW,MAAMP,CAAC,IACXS,MAAST,KACXR,EAAA,IAAIQ,GAAGO,CAAU,GAGnBP;AAAA,EAAA,CACV,GAEDU,EAAU,MAAM;AACZ,UAAMV,IAAIG,EAAI;AACd,IAAIH,KACAR,EAAK,OAAOQ,CAAC;AAAA,EACjB,CACH,GAEM,CAACM,GAASF,CAAM;AAC3B;"}