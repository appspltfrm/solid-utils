{"version":3,"file":"index.js","sources":["../../src/lib/elements/CustomElement.ts","../../node_modules/solid-js/h/jsx-runtime/dist/jsx.js","../../src/lib/elements/camelPropsToDashedAttrs.ts","../../node_modules/component-register/dist/component-register.js","../../node_modules/solid-element/dist/index.js","../../src/lib/elements/registerElement.tsx","../../src/lib/elements/elementComponent.tsx","../../src/lib/elements/decorators/customElement.tsx","../../src/lib/elements/decorators/reactive.ts"],"sourcesContent":["import {JSX} from \"solid-js/h/jsx-runtime\";\nimport {ElementTemplate} from \"./ElementTemplate\";\n\nexport abstract class CustomElement extends HTMLElement {\n\n    abstract template(args: ElementTemplate<this>): JSX.Element;\n\n    get renderRoot(): ShadowRoot | this {\n        return this.shadowRoot ?? this.attachShadow({mode: \"open\"});\n    }\n\n}\n\n","export { default as jsx, default as jsxDEV, default as jsxs } from 'solid-js/h';\n\nfunction Fragment(props) {\n  return props.children;\n}\n\nexport { Fragment };\n","export function camelPropsToDashedAttrs<T extends { [key: string]: any }>(props: T): T {\n    const niu: any = {};\n\n    for (const [k, v] of Object.entries(props)) {\n        // niu[k.toLowerCase().replace(/(-)([a-z])/g, test => test.toUpperCase().replace(\"-\", \"\"))] = v;\n        niu[k.replace(/\\.?([A-Z]+)/g, (x, y) => \"-\" + y.toLowerCase()).replace(\"_\", \"-\").replace(/^-/, \"\")] = v;\n    }\n\n    return niu;\n}\n","function cloneProps(props) {\n  const propKeys = Object.keys(props);\n  return propKeys.reduce((memo, k) => {\n    const prop = props[k];\n    memo[k] = Object.assign({}, prop);\n    if (isObject(prop.value) && !isFunction(prop.value) && !Array.isArray(prop.value)) memo[k].value = Object.assign({}, prop.value);\n    if (Array.isArray(prop.value)) memo[k].value = prop.value.slice(0);\n    return memo;\n  }, {});\n}\n\nfunction normalizePropDefs(props) {\n  if (!props) return {};\n  const propKeys = Object.keys(props);\n  return propKeys.reduce((memo, k) => {\n    const v = props[k];\n    memo[k] = !(isObject(v) && \"value\" in v) ? {\n      value: v\n    } : v;\n    memo[k].attribute || (memo[k].attribute = toAttribute(k));\n    memo[k].parse = \"parse\" in memo[k] ? memo[k].parse : typeof memo[k].value !== \"string\";\n    return memo;\n  }, {});\n}\nfunction propValues(props) {\n  const propKeys = Object.keys(props);\n  return propKeys.reduce((memo, k) => {\n    memo[k] = props[k].value;\n    return memo;\n  }, {});\n}\nfunction initializeProps(element, propDefinition) {\n  const props = cloneProps(propDefinition),\n        propKeys = Object.keys(propDefinition);\n  propKeys.forEach(key => {\n    const prop = props[key],\n          attr = element.getAttribute(prop.attribute),\n          value = element[key];\n    if (attr) prop.value = prop.parse ? parseAttributeValue(attr) : attr;\n    if (value != null) prop.value = Array.isArray(value) ? value.slice(0) : value;\n    prop.reflect && reflect(element, prop.attribute, prop.value);\n    Object.defineProperty(element, key, {\n      get() {\n        return prop.value;\n      },\n\n      set(val) {\n        const oldValue = prop.value;\n        prop.value = val;\n        prop.reflect && reflect(this, prop.attribute, prop.value);\n\n        for (let i = 0, l = this.__propertyChangedCallbacks.length; i < l; i++) {\n          this.__propertyChangedCallbacks[i](key, val, oldValue);\n        }\n      },\n\n      enumerable: true,\n      configurable: true\n    });\n  });\n  return props;\n}\nfunction parseAttributeValue(value) {\n  if (!value) return;\n\n  try {\n    return JSON.parse(value);\n  } catch (err) {\n    return value;\n  }\n}\nfunction reflect(node, attribute, value) {\n  if (value == null || value === false) return node.removeAttribute(attribute);\n  let reflect = JSON.stringify(value);\n  node.__updating[attribute] = true;\n  if (reflect === \"true\") reflect = \"\";\n  node.setAttribute(attribute, reflect);\n  Promise.resolve().then(() => delete node.__updating[attribute]);\n}\nfunction toAttribute(propName) {\n  return propName.replace(/\\.?([A-Z]+)/g, (x, y) => \"-\" + y.toLowerCase()).replace(\"_\", \"-\").replace(/^-/, \"\");\n}\nfunction toProperty(attr) {\n  return attr.toLowerCase().replace(/(-)([a-z])/g, test => test.toUpperCase().replace(\"-\", \"\"));\n}\nfunction isObject(obj) {\n  return obj != null && (typeof obj === \"object\" || typeof obj === \"function\");\n}\nfunction isFunction(val) {\n  return Object.prototype.toString.call(val) === \"[object Function]\";\n}\nfunction isConstructor(f) {\n  return typeof f === \"function\" && f.toString().indexOf(\"class\") === 0;\n}\nfunction reloadElement(node) {\n  let callback = null;\n\n  while (callback = node.__releaseCallbacks.pop()) callback(node);\n\n  delete node.__initialized;\n  node.renderRoot.textContent = \"\";\n  node.connectedCallback();\n}\n\nlet currentElement;\nfunction getCurrentElement() {\n  return currentElement;\n}\nfunction noShadowDOM() {\n  Object.defineProperty(currentElement, \"renderRoot\", {\n    value: currentElement\n  });\n}\nfunction createElementType(BaseElement, propDefinition) {\n  const propKeys = Object.keys(propDefinition);\n  return class CustomElement extends BaseElement {\n    static get observedAttributes() {\n      return propKeys.map(k => propDefinition[k].attribute);\n    }\n\n    constructor() {\n      super();\n      this.__initialized = false;\n      this.__released = false;\n      this.__releaseCallbacks = [];\n      this.__propertyChangedCallbacks = [];\n      this.__updating = {};\n      this.props = {};\n    }\n\n    connectedCallback() {\n      if (this.__initialized) return;\n      this.__releaseCallbacks = [];\n      this.__propertyChangedCallbacks = [];\n      this.__updating = {};\n      this.props = initializeProps(this, propDefinition);\n      const props = propValues(this.props),\n            ComponentType = this.Component,\n            outerElement = currentElement;\n\n      try {\n        currentElement = this;\n        this.__initialized = true;\n        if (isConstructor(ComponentType)) new ComponentType(props, {\n          element: this\n        });else ComponentType(props, {\n          element: this\n        });\n      } finally {\n        currentElement = outerElement;\n      }\n    }\n\n    async disconnectedCallback() {\n      // prevent premature releasing when element is only temporarely removed from DOM\n      await Promise.resolve();\n      if (this.isConnected) return;\n      this.__propertyChangedCallbacks.length = 0;\n      let callback = null;\n\n      while (callback = this.__releaseCallbacks.pop()) callback(this);\n\n      delete this.__initialized;\n      this.__released = true;\n    }\n\n    attributeChangedCallback(name, oldVal, newVal) {\n      if (!this.__initialized) return;\n      if (this.__updating[name]) return;\n      name = this.lookupProp(name);\n\n      if (name in propDefinition) {\n        if (newVal == null && !this[name]) return;\n        this[name] = propDefinition[name].parse ? parseAttributeValue(newVal) : newVal;\n      }\n    }\n\n    lookupProp(attrName) {\n      if (!propDefinition) return;\n      return propKeys.find(k => attrName === k || attrName === propDefinition[k].attribute);\n    }\n\n    get renderRoot() {\n      return this.shadowRoot || this.attachShadow({\n        mode: \"open\"\n      });\n    }\n\n    addReleaseCallback(fn) {\n      this.__releaseCallbacks.push(fn);\n    }\n\n    addPropertyChangedCallback(fn) {\n      this.__propertyChangedCallbacks.push(fn);\n    }\n\n  };\n}\n\nfunction createMixin(mixinFn) {\n  return ComponentType => (props, options) => {\n    options = mixinFn(options);\n    if (isConstructor(ComponentType)) return new ComponentType(props, options);\n    return ComponentType(props, options);\n  };\n}\nfunction compose(...fns) {\n  if (fns.length === 0) return i => i;\n  if (fns.length === 1) return fns[0];\n  return fns.reduce((a, b) => (...args) => a(b(...args)));\n}\n\nconst EC = Symbol('element-context');\n\nfunction lookupContext(element, context) {\n  return element[EC] && element[EC][context.id] || (element.host || element.parentNode) && lookupContext(element.host || element.parentNode, context);\n}\n\nfunction createContext(initFn) {\n  return {\n    id: Symbol('context'),\n    initFn\n  };\n} // Direct\n\nfunction provide(context, value, element = getCurrentElement()) {\n  element[EC] || (element[EC] = {});\n  return element[EC][context.id] = context.initFn ? context.initFn(value) : value;\n}\nfunction consume(context, element = getCurrentElement()) {\n  return lookupContext(element, context);\n} // HOCs\n\nfunction withProvider(context, value) {\n  return createMixin(options => {\n    const {\n      element\n    } = options;\n    provide(context, value, element);\n    return options;\n  });\n}\nfunction withConsumer(context, key) {\n  return createMixin(options => {\n    const {\n      element\n    } = options;\n    options = Object.assign({}, options, {\n      [key]: lookupContext(element, context)\n    });\n    return options;\n  });\n}\n\nfunction walk(root, call) {\n  call(root);\n  if (root.shadowRoot) walk(root.shadowRoot, call);\n  let child = root.firstChild;\n\n  while (child) {\n    child.nodeType === 1 && walk(child, call);\n    child = child.nextSibling;\n  }\n}\n\nfunction hot(module, tagName) {\n  if (module.hot) {\n    function update(possibleError) {\n      if (possibleError && possibleError instanceof Error) {\n        console.error(possibleError);\n        return;\n      }\n\n      walk(document.body, node => node.localName === tagName && setTimeout(() => reloadElement(node), 0));\n    } // handle both Parcel and Webpack style\n\n\n    module.hot.accept(update);\n\n    if (module.hot.status && module.hot.status() === 'apply') {\n      update();\n    }\n  }\n}\n\nfunction register(tag, props = {}, options = {}) {\n  const {\n    BaseElement = HTMLElement,\n    extension\n  } = options;\n  return ComponentType => {\n    if (!tag) throw new Error(\"tag is required to register a Component\");\n    let ElementType = customElements.get(tag);\n\n    if (ElementType) {\n      // Consider disabling this in a production mode\n      ElementType.prototype.Component = ComponentType;\n      return ElementType;\n    }\n\n    ElementType = createElementType(BaseElement, normalizePropDefs(props));\n    ElementType.prototype.Component = ComponentType;\n    ElementType.prototype.registeredTag = tag;\n    customElements.define(tag, ElementType, extension);\n    return ElementType;\n  };\n}\n\nexport { compose, consume, createContext, createMixin, getCurrentElement, hot, isConstructor, isFunction, isObject, noShadowDOM, provide, register, reloadElement, toAttribute, toProperty, withConsumer, withProvider };\n","import { register } from \"component-register\";\nexport { hot, getCurrentElement, noShadowDOM } from \"component-register\";\nimport { createRoot, createSignal } from \"solid-js\";\nimport { insert } from \"solid-js/web\";\nfunction createProps(raw) {\n    const keys = Object.keys(raw);\n    const props = {};\n    for (let i = 0; i < keys.length; i++) {\n        const [get, set] = createSignal(raw[keys[i]]);\n        Object.defineProperty(props, keys[i], {\n            get,\n            set(v) {\n                set(() => v);\n            }\n        });\n    }\n    return props;\n}\nfunction lookupContext(el) {\n    if (el.assignedSlot && el.assignedSlot._$owner)\n        return el.assignedSlot._$owner;\n    let next = el.parentNode;\n    while (next &&\n        !next._$owner &&\n        !(next.assignedSlot && next.assignedSlot._$owner))\n        next = next.parentNode;\n    return next && next.assignedSlot\n        ? next.assignedSlot._$owner\n        : el._$owner;\n}\nfunction withSolid(ComponentType) {\n    return (rawProps, options) => {\n        const { element } = options;\n        return createRoot((dispose) => {\n            const props = createProps(rawProps);\n            element.addPropertyChangedCallback((key, val) => (props[key] = val));\n            element.addReleaseCallback(() => {\n                element.renderRoot.textContent = \"\";\n                dispose();\n            });\n            const comp = ComponentType(props, options);\n            return insert(element.renderRoot, comp);\n        }, lookupContext(element));\n    };\n}\nfunction customElement(tag, props, ComponentType) {\n    if (arguments.length === 2) {\n        ComponentType = props;\n        props = {};\n    }\n    return register(tag, props)(withSolid(ComponentType));\n}\nexport { withSolid, customElement };\n","import {compose, register} from \"component-register\";\nimport {getCurrentElement, withSolid} from \"solid-element\";\nimport {Fragment, JSX} from \"solid-js/h/jsx-runtime\";\n\nexport function registerElement(tagName: string, elementConstructor: any) {\n\n    if (customElements.get(tagName)) {\n        return;\n    }\n\n    const extendedConstructor: {__reactive: string[]} = elementConstructor;\n\n    const propsDefinitions: {[propName: string]: {\n            value: undefined;\n            attribute: string;\n            notify: boolean;\n            reflect: boolean;\n            parse: boolean;\n        }} = {};\n\n    for (const prop of extendedConstructor.__reactive ?? []) {\n        propsDefinitions[prop] = Object.assign({value: undefined});\n    }\n\n    const renderRoot = Object.getOwnPropertyDescriptor(elementConstructor.prototype, \"renderRoot\");\n\n    const element = compose(register(tagName, propsDefinitions, {BaseElement: elementConstructor}), withSolid)((props) => {\n        const element: {template: (props: any) => JSX.Element} = getCurrentElement() as any;\n        return <Fragment>\n                {element.template({props})}\n            </Fragment>\n    });\n\n    if (renderRoot) {\n        Object.defineProperty(element.prototype, \"renderRoot\", renderRoot);\n    }\n\n}\n","import {Type} from \"@co.mmons/js-utils/core\";\nimport {Component, splitProps} from \"solid-js\";\nimport {JSX} from \"solid-js/h/jsx-runtime\";\nimport {Dynamic} from \"solid-js/web\";\nimport {SetRequired} from \"type-fest\";\nimport {camelPropsToDashedAttrs} from \"./camelPropsToDashedAttrs\";\nimport {CustomElement} from \"./CustomElement\";\nimport {ElementEventsProps} from \"./ElementEventsProps\";\nimport {ElementProps} from \"./ElementProps\";\nimport {registerElement} from \"./registerElement\";\n\ntype ElementComponent<TagName extends string, ElementType extends CustomElement, ComponentProps = any> = Component<JSX.HTMLAttributes<ElementType> & ComponentProps> & {\n    tagName: TagName;\n    events<Events extends {[EventName in keyof Events]: Event}>(): ElementComponent<TagName, ElementType, ComponentProps & ElementEventsProps<ElementType, Events>>;\n    required<PropName extends keyof ElementProps<ElementType>>(first: PropName, ...others: PropName[]): ElementComponent<TagName, ElementType, ComponentProps & SetRequired<ElementProps<ElementType>, PropName>>;\n}\n\nexport function elementComponent<TagName extends string, ElementType extends CustomElement>(tagName: TagName, elementType: Type<ElementType>): ElementComponent<TagName, ElementType, Omit<ElementProps<ElementType>, keyof HTMLElement | keyof CustomElement>> {\n\n    registerElement(tagName, elementType);\n\n    const extendedType: Type<ElementType> & {__reactive: string[]} = elementType as any;\n\n    const template: Component<any> = (rawProps) => {\n        const [, props, other] = splitProps(rawProps, [\"children\"], extendedType.__reactive ?? []);\n        return <Dynamic component={tagName as any} {...camelPropsToDashedAttrs(props)} {...other}/>\n    }\n\n    const component = template as any as ElementComponent<TagName, ElementType, ElementProps<ElementType>>;\n    component[\"tagName\"] = tagName;\n    component[\"events\"] = () => component;\n    component[\"required\"] = () => component;\n\n    return component as any;\n}\n","import {registerElement} from \"../registerElement\";\n\nexport function customElement(tagName: string) {\n    return function(elementConstructor: any) {\n        registerElement(tagName, elementConstructor);\n    }\n}\n","export function reactive() {\n\n    return (proto: any, propName: string, propertyDescriptor?: PropertyDescriptor) => {\n        const constructor = proto.constructor;\n        const reactive: string[] = constructor.__reactive ?? [];\n        reactive.push(propName);\n\n        constructor.__reactive = reactive;\n    }\n}\n"],"names":["CustomElement","Fragment","props","camelPropsToDashedAttrs","niu","k","v","x","y","cloneProps","memo","prop","isObject","isFunction","normalizePropDefs","toAttribute","propValues","initializeProps","element","propDefinition","key","attr","value","parseAttributeValue","reflect","val","oldValue","i","l","node","attribute","propName","obj","isConstructor","f","currentElement","getCurrentElement","createElementType","BaseElement","propKeys","ComponentType","outerElement","callback","name","oldVal","newVal","attrName","fn","compose","fns","a","b","args","register","tag","options","extension","ElementType","createProps","raw","keys","get","set","createSignal","lookupContext","el","next","withSolid","rawProps","createRoot","dispose","comp","insert","registerElement","tagName","elementConstructor","customElements","extendedConstructor","propsDefinitions","__reactive","Object","assign","undefined","renderRoot","getOwnPropertyDescriptor","prototype","_$createComponent","template","defineProperty","elementComponent","elementType","extendedType","component","other","splitProps","Dynamic","_$mergeProps","customElement","reactive","proto","propertyDescriptor","constructor"],"mappings":"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"}