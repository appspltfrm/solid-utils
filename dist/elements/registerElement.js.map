{"version":3,"file":"registerElement.js","sources":["../../src/lib/elements/registerElement.tsx"],"sourcesContent":["import {AssignableType} from \"@co.mmons/js-utils/core\";\nimport {compose, ICustomElement, register} from \"component-register\";\nimport {getCurrentElement, withSolid} from \"solid-element\";\nimport {splitProps} from \"solid-js\";\nimport {SolidElement} from \"./SolidElement\";\n\nexport function registerElement<ElementType extends SolidElement>(tagName: string, elementConstructor: AssignableType<ElementType>) {\n\n    if (customElements.get(tagName)) {\n        return;\n    }\n\n    const extendedConstructor: {reactive: {[propName: string]: boolean}, __shadowStyles: string | string[]} = elementConstructor as any;\n\n    const propsDefinitions: {[propName: string]: {\n            value: undefined;\n            attribute: string;\n            notify: boolean;\n            reflect: boolean;\n            parse: boolean;\n        }} = {slottedChildren: undefined as any};\n\n    for (const propName of Object.keys(extendedConstructor.reactive ?? {})) {\n        propsDefinitions[propName] = Object.assign({value: undefined, parse: true, reflect: true});\n    }\n\n    const connectedCallback = elementConstructor.prototype.connectedCallback;\n    const disconnectedCallback = elementConstructor.prototype.disconnectedCallback;\n\n    let renderRoot: PropertyDescriptor | undefined;\n\n    let parentClass = elementConstructor;\n    while (parentClass !== HTMLElement) {\n        renderRoot = Object.getOwnPropertyDescriptor(parentClass.prototype, \"renderRoot\");\n        if (renderRoot) {\n            break;\n        }\n        parentClass = Object.getPrototypeOf(parentClass);\n    }\n\n    const finalConstructor = compose(register(tagName, propsDefinitions, {BaseElement: elementConstructor}), withSolid)((rawProps) => {\n\n        const shadowStyles = extendedConstructor.__shadowStyles;\n        const [children, props] = splitProps(rawProps, [\"slottedChildren\"]);\n        const element = getCurrentElement() as any as SolidElement & ICustomElement;\n\n        if (connectedCallback) {\n            connectedCallback.call(element);\n        }\n\n        if (disconnectedCallback) {\n            element.addReleaseCallback(() => disconnectedCallback.call(element));\n        }\n\n        return <>\n            {element.renderRoot === element.shadowRoot && shadowStyles && (typeof shadowStyles === \"string\" ? [shadowStyles] : shadowStyles).map(style => <style>{style}</style>)}\n            {element[\"template\"]({props, children: children.slottedChildren ?? []})}\n        </>\n    });\n\n    if (renderRoot?.get) {\n        Object.defineProperty(finalConstructor.prototype, \"renderRoot\", {\n            get() {\n                const root = renderRoot?.get?.call(this);\n                if (root) {\n                    return root;\n                } else {\n                    const shadow = (this as HTMLElement).shadowRoot;\n                    if (!shadow) {\n                        return (this as HTMLElement).attachShadow({mode: \"open\"});\n                    }\n                }\n            }\n        })\n    }\n}\n"],"names":["registerElement","tagName","elementConstructor","customElements","get","extendedConstructor","propsDefinitions","slottedChildren","undefined","propName","Object","keys","reactive","assign","value","parse","reflect","connectedCallback","prototype","disconnectedCallback","renderRoot","parentClass","HTMLElement","getOwnPropertyDescriptor","getPrototypeOf","finalConstructor","compose","register","BaseElement","withSolid","rawProps","shadowStyles","__shadowStyles","children","props","splitProps","element","getCurrentElement","call","addReleaseCallback","_$memo","shadowRoot","_c$","map","style","_el$","_tmpl$","_$insert","defineProperty","root","attachShadow","mode"],"mappings":";;;;;AAMO,SAASA,EAAkDC,GAAiBC,GAAiD;AAEhI,MAAIC,eAAeC,IAAIH,CAAO;AAC1B;AAGJ,QAAMI,IAAoGH,GAEpGI,IAMG;AAAA,IAACC,iBAAiBC;AAAAA;AAE3B,aAAWC,KAAYC,OAAOC,KAAKN,EAAoBO,YAAY,CAAA,CAAE;AACjEN,IAAAA,EAAiBG,CAAQ,IAAIC,OAAOG,OAAO;AAAA,MAACC,OAAON;AAAAA,MAAWO,OAAO;AAAA,MAAMC,SAAS;AAAA,IAAI,CAAC;AAG7F,QAAMC,IAAoBf,EAAmBgB,UAAUD,mBACjDE,IAAuBjB,EAAmBgB,UAAUC;AAE1D,MAAIC,GAEAC,IAAcnB;AAClB,SAAOmB,MAAgBC,gBACnBF,IAAaV,OAAOa,yBAAyBF,EAAYH,WAAW,YAAY,GAC5EE,CAAAA;AAGJC,IAAAA,IAAcX,OAAOc,eAAeH,CAAW;AAGnD,QAAMI,IAAmBC,EAAQC,EAAS1B,GAASK,GAAkB;AAAA,IAACsB,aAAa1B;AAAAA,EAAkB,CAAC,GAAG2B,CAAS,EAAGC,CAAAA,MAAa;AAE9H,UAAMC,IAAe1B,EAAoB2B,gBACnC,CAACC,GAAUC,CAAK,IAAIC,EAAWL,GAAU,CAAC,iBAAiB,CAAC,GAC5DM,IAAUC;AAEhB,WAAIpB,KACAA,EAAkBqB,KAAKF,CAAO,GAG9BjB,KACAiB,EAAQG,mBAAmB,MAAMpB,EAAqBmB,KAAKF,CAAO,CAAC,GAGvE,CAAAI,GAAA,MAAA;AAAA,YACKJ,IAAAA,EAAAA,MAAAA,CAAAA,EAAAA,EAAQhB,eAAegB,EAAQK,cAAcV,EAAY;AAAA,aAAA,MAAzDW,EAA6D,MAAC,OAAOX,KAAiB,WAAW,CAACA,CAAY,IAAIA,GAAcY,IAAIC,CAAAA,OAAK,MAAA;AAAA,cAAAC,IAAAC,EAAA,UAAA,EAAA;AAAAC,eAAAA,EAAAF,GAAYD,CAAK,GAAAC;AAAA,MAAA,GAAA,CAAS;AAAA,IAAC,GAAA,CAAA,GAAAL,EAAA,MACpKJ,EAAQ,SAAY;AAAA,MAACF,OAAAA;AAAAA,MAAOD,UAAUA,EAAS1B,mBAAmB,CAAA;AAAA,IAAG,CAAA,CAAC,CAAA;AAAA,EAE/E,CAAC;AAED,EAAIa,KAAAA,QAAAA,EAAYhB,OACZM,OAAOsC,eAAevB,EAAiBP,WAAW,cAAc;AAAA,IAC5Dd,MAAM;;AACF,YAAM6C,KAAO7B,IAAAA,KAAAA,gBAAAA,EAAYhB,QAAZgB,gBAAAA,EAAiBkB,KAAK;AACnC,UAAIW;AACA,eAAOA;AAGP,UAAI,CADY,KAAqBR;AAEjC,eAAQ,KAAqBS,aAAa;AAAA,UAACC,MAAM;AAAA,QAAM,CAAC;AAAA,IAGpE;AAAA,EACJ,CAAC;AAET;"}