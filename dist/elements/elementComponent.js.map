{"version":3,"file":"elementComponent.js","sources":["../../src/lib/elements/elementComponent.tsx"],"sourcesContent":["import type {AssignableType, Type} from \"@co.mmons/js-utils/core\";\nimport {children, Component, mergeProps, ParentProps, sharedConfig, splitProps} from \"solid-js\";\nimport {JSX} from \"solid-js/h/jsx-runtime\";\nimport {getNextElement, spread} from \"solid-js/web\";\nimport {ElementAttrAttributes} from \"./ElementAttrAttributes\";\nimport {ElementEventsProps} from \"./ElementEventsProps\";\nimport {ElementProps} from \"./ElementProps\";\nimport {registerElement} from \"./registerElement\";\nimport {SolidElement} from \"./SolidElement\";\n\nexport type ElementComponent<TagName extends string, ElementType extends SolidElement, ComponentProps = any> = Component<ComponentProps & JSX.HTMLAttributes<ElementType> & ElementAttrAttributes> & {\n    tagName: TagName;\n    configure<Props = ComponentProps, Events extends {[P in keyof Events]: Event} = any>(): ElementComponent<TagName, ElementType, Props & ElementEventsProps<ElementType, Events>>;\n    register(): void\n}\n\nexport function elementComponent<TagName extends string, ElementType extends SolidElement>(tagName: TagName, elementType: AssignableType<ElementType>): ElementComponent<TagName, ElementType, ElementProps<ElementType>> {\n\n    const extendedType: Type<ElementType> & {reactive: {[propName: string]: boolean}} = elementType as any;\n\n    const template: Component<any> = (rawProps: ParentProps<any>) => {\n        if (!customElements.get(tagName)) {\n            registerElement(tagName, elementType);\n        }\n\n        const el = sharedConfig.context ? getNextElement() : document.createElement(tagName);\n        const noShadow = (el as any)[\"renderRoot\"] === el;\n\n        const rawChildren = children(() => rawProps.children);\n        const [, props, others] = splitProps(rawProps, [\"children\"], Object.keys(extendedType.reactive ?? {}));\n\n        for (const key of Object.keys(props)) {\n            const dashed = key.replace(/\\.?([A-Z]+)/g, (x, y) => \"-\" + y.toLowerCase()).replace(\"_\", \"-\").replace(/^-/, \"\");\n            if (key !== dashed) {\n                Object.defineProperty(props, dashed, {get: () => props[key]});\n            }\n        }\n\n        const allProps = mergeProps(props, others, {\n            children: (!noShadow && rawChildren) ?? [],\n            \"slotted-children\": (noShadow && rawChildren.toArray()) ?? []\n        })\n\n        spread(el, mergeProps(props, others, {\n            children: (!noShadow && rawChildren) ?? [],\n            \"slotted-children\": (noShadow && rawChildren.toArray()) ?? []}\n        ), false, noShadow);\n\n        return el;\n    }\n\n    const component = template as any as ElementComponent<TagName, ElementType, ElementProps<ElementType>>;\n    component[\"tagName\"] = tagName;\n    component[\"configure\"] = () => component as any;\n    component[\"register\"] = () => registerElement(tagName, elementType);\n\n    return component as any;\n}\n"],"names":["elementComponent","tagName","elementType","extendedType","component","rawProps","customElements","get","registerElement","el","sharedConfig","context","getNextElement","document","createElement","noShadow","rawChildren","children","props","others","splitProps","Object","keys","reactive","key","dashed","replace","x","y","toLowerCase","defineProperty","mergeProps","toArray","spread"],"mappings":";;;AAgBO,SAASA,EAA2EC,GAAkBC,GAA6G;AAEtN,QAAMC,IAA8ED,GAiC9EE,IA/B4BC,CAAAA,MAA+B;AAC7D,IAAKC,eAAeC,IAAIN,CAAO,KAC3BO,EAAgBP,GAASC,CAAW;AAGxC,UAAMO,IAAKC,EAAaC,UAAUC,EAAgB,IAAGC,SAASC,cAAcb,CAAO,GAC7Ec,IAAYN,EAAW,eAAkBA,GAEzCO,IAAcC,EAAS,MAAMZ,EAASY,QAAQ,GAC9C,CAAGC,EAAAA,GAAOC,CAAM,IAAIC,EAAWf,GAAU,CAAC,UAAU,GAAGgB,OAAOC,KAAKnB,EAAaoB,YAAY,CAAA,CAAE,CAAC;AAErG,eAAWC,KAAOH,OAAOC,KAAKJ,CAAK,GAAG;AAClC,YAAMO,IAASD,EAAIE,QAAQ,gBAAgB,CAACC,GAAGC,MAAM,MAAMA,EAAEC,aAAa,EAAEH,QAAQ,KAAK,GAAG,EAAEA,QAAQ,MAAM,EAAE;AAC9G,MAAIF,MAAQC,KACRJ,OAAOS,eAAeZ,GAAOO,GAAQ;AAAA,QAAClB,KAAK,MAAMW,EAAMM,CAAG;AAAA,MAAC,CAAC;AAAA,IAEpE;AAEiBO,WAAAA,EAAWb,GAAOC,GAAQ;AAAA,MACvCF,WAAW,CAACF,KAAYC,MAAgB,CAAE;AAAA,MAC1C,qBAAqBD,KAAYC,EAAYgB,QAAS,MAAK,CAAA;AAAA,IAC/D,CAAC,GAEDC,EAAOxB,GAAIsB,EAAWb,GAAOC,GAAQ;AAAA,MACjCF,WAAW,CAACF,KAAYC,MAAgB,CAAE;AAAA,MAC1C,qBAAqBD,KAAYC,EAAYgB,QAAS,MAAK,CAAA;AAAA,IAAE,CAAC,GAC/D,IAAOjB,CAAQ,GAEXN;AAAAA;AAIXL,SAAAA,EAAU,UAAaH,GACvBG,EAAU,YAAe,MAAMA,GAC/BA,EAAU,WAAc,MAAMI,EAAgBP,GAASC,CAAW,GAE3DE;AACX;"}